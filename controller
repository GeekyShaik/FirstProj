global:
  runtime:
    ## Supported frameworks are "spring" and "jboss"
    framework: spring
    ## Context root for the application
    contextRoot: "/v1/enterprise/metadata-services"
    environment: "review"

#Check here for a full list of values you can override (including HPA, resource limits, etc.)
#https://go/apichart
usaa-talon-api:
  deployment:
    progressDeadlineSeconds: 660
  application:
    livenessProbe:
      httpGet:
        path: "v1/enterprise/metadata-services/actuator/health/liveness"
        port: 8080
        scheme: HTTP
      initialDelaySeconds: 75
      periodSeconds: 10
      successThreshold: 1
      failureThreshold: 5
      timeoutSeconds: 5
    readinessProbe:
      httpGet:
        path: "v1/enterprise/metadata-services/actuator/health/readiness"
        port: 8080
        scheme: HTTP
      initialDelaySeconds: 75
      periodSeconds: 10
      successThreshold: 1
      failureThreshold: 5
      timeoutSeconds: 5
    startupProbe:
      httpGet:
        path: "/v1/enterprise/metadata-services/actuator/health/liveness"
        port: 8080
        scheme: HTTP
      initialDelaySeconds: 75
      periodSeconds: 10
      successThreshold: 1
      failureThreshold: 5
      timeoutSeconds: 5
  hpa:
    enabled: false
  opentracing:
    enabled: true
  prometheus:
    serviceMonitor:
      enabled: true
      endpoints:
      - port: http
        path: "/v1/enterprise/metadata-services/actuator/prometheus"
        interval: 30s
  conjurAuthenticator:
    enabled: true
  pdb:
    enabled: true
    minAvailable: 1
  usaa-gloo-api:
    enabled: true
    apiId: a56ef025-8916-4edb-907c-6cbdd9c755b0
    projectId: 88354
    authConfig:
      apiKey:
        enabled: true
        headerName: api-key
    routeTable:
      weight: 50
      testCookieRouting:
        enabled: true
      methods:
        - GET
  # see https://go/extauth for more info
  envoy:
    enabled: true
    config:
      routes:
      - match:
          prefix: "/v1/enterprise/metadata-services/actuator/"
        route:
          host_rewrite_literal: localhost
          cluster: "{{ .Release.Name }}"
        typed_per_filter_config:
          envoy.filters.http.ext_authz:
            "@type": type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthzPerRoute
            disabled: true
      - match:
          prefix: "/"
        route:
          host_rewrite_literal: localhost
          cluster: "{{ .Release.Name }}"
      rules:
        action: ALLOW
        policies:
          AUTH_POLICY:
            principals:
            - header: { name: "roles", contains_match: "ROLE_GENESIS_EXP" }
            permissions:
            - any: true
          HEALTH_POLICY:
            principals:
            - any: true
            permissions:
            - header: { name: ":path", prefix_match: "/v1/enterprise/metadata-services/actuator" }
  extauth:
    enabled: true
    extraEnv:
      - name: PORTFOLIO
        value: "ENT"
    roles:
      dev:
        ROLE_GENESIS_EXP:
          - ASG_CONTENT_AUTHORING_LIBRARIAN_EXP_TEST
      test:
        ROLE_GENESIS_EXP:
          - ASG_CONTENT_AUTHORING_LIBRARIAN_EXP_TEST
      prod:
        ROLE_GENESIS_EXP:
          - ASG_CONTENT_AUTHORING_LIBRARIAN_EXP_PROD
